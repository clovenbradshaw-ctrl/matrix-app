<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Room Notes</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: system-ui, sans-serif; padding: 20px; background: #f5f5f5; }
        .status { padding: 10px; margin-bottom: 15px; border-radius: 6px; font-size: 14px; }
        .status.ok { background: #d4edda; color: #155724; }
        .status.err { background: #f8d7da; color: #721c24; }
        textarea { width: 100%; padding: 12px; font-size: 14px; border: 2px solid #ddd; border-radius: 6px; min-height: 300px; font-family: inherit; }
        button { padding: 12px 24px; margin: 10px 10px 0 0; border: none; border-radius: 6px; background: #667eea; color: white; font-size: 14px; font-weight: 600; cursor: pointer; }
        button:hover { background: #5568d3; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
    </style>
</head>
<body>
    <div class="status" id="s">‚è≥ Connecting...</div>
    <h2>üìù Room Notes</h2>
    <textarea id="t" placeholder="Your notes..." disabled></textarea>
    <br>
    <button id="save" onclick="save()" disabled>üíæ Save</button>
    <button id="load" onclick="load()" disabled>üîÑ Load</button>

    <script>
        const DATA = 'hyphae.notes';
        let ready = false;

        // Send message to parent
        function send(action, data) {
            window.parent.postMessage({
                api: 'fromWidget',
                widgetId: 'notes',
                requestId: Date.now() + Math.random(),
                action: action,
                data: data || {}
            }, '*');
        }

        // Listen for messages from parent
        window.addEventListener('message', (e) => {
            console.log('Got message:', e.data);
            if (e.data && e.data.api === 'toWidget') {
                if (e.data.action === 'capabilities') {
                    // Respond to capabilities request
                    window.parent.postMessage({
                        api: 'fromWidget',
                        widgetId: 'notes',
                        requestId: e.data.requestId,
                        action: 'capabilities',
                        response: { capabilities: [] }
                    }, '*');
                }
            }
        });

        // Start widget
        window.addEventListener('load', () => {
            console.log('Widget loaded');
            
            // Send ready
            setTimeout(() => {
                console.log('Sending ready...');
                send('ready', {});
                
                ready = true;
                document.getElementById('s').textContent = '‚úÖ Ready to use';
                document.getElementById('s').className = 'status ok';
                document.getElementById('t').disabled = false;
                document.getElementById('save').disabled = false;
                document.getElementById('load').disabled = false;
            }, 1000);
        });

        function save() {
            const text = document.getElementById('t').value;
            localStorage.setItem(DATA, text);
            document.getElementById('s').textContent = '‚úÖ Saved to browser storage!';
            document.getElementById('s').className = 'status ok';
            console.log('Saved:', text.length, 'chars');
        }

        function load() {
            const text = localStorage.getItem(DATA) || '';
            document.getElementById('t').value = text;
            document.getElementById('s').textContent = text ? '‚úÖ Loaded!' : 'üìù No saved notes';
            document.getElementById('s').className = 'status ok';
            console.log('Loaded:', text.length, 'chars');
        }
    </script>
</body>
</html>
